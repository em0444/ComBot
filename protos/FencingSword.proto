#VRML_SIM R2025a utf8

EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2025a/projects/appearances/protos/BrushedAluminium.proto"

PROTO FencingSword [
  field SFVec3f    translation         2 0 0.8
  field SFRotation rotation            0 0 1 0
  field SFString   name                "Fencing Sword"
  field SFString   contactMaterial     "default"
  field MFNode     children            [] 
  field SFFloat    mass                1 
  field SFFloat    density             -1 
  field SFVec3f    meshScale           0.01 0.01 0.01
  field SFBool     locked              FALSE
  field SFVec3f    linearVelocity      0 0 0
  field SFVec3f    angularVelocity     0 0 0
]
{
  DEF FENCING_SWORD_SOLID Solid {
    translation IS translation
    rotation IS rotation
    name IS name
    model "Fencing Sword"
    contactMaterial IS contactMaterial
    locked IS locked
    linearVelocity IS linearVelocity
    angularVelocity IS angularVelocity

    children [
      # Visual Mesh for Fencing Foil
      Transform {
        scale IS meshScale
        children [
          Shape {
            castShadows FALSE
            appearance BrushedAluminium {
            }
            geometry Mesh {
              url [ "../protos/icons/sword.obj" ] 
            }
          }
        ]
      }

    # 2. THE CONNECTOR (New Addition)
    # This creates a "magnet point" at the handle location.
    Pose {
      translation 0 -0.25 0.06  # Same position as your handle collision
      rotation 1 0 0 1.5708     # Same rotation (aligned with handle)
      children [
        DEF SWORD_CONNECTOR Connector {
          type "symmetric"      # Can connect to any symmetric connector
          isLocked FALSE        # Starts unlocked
          autoLock TRUE         # Automatically locks when robot touches it
          distanceTolerance 0.02 # How close the hand must be (2cm)
          axisTolerance 0.2     # Angle tolerance (radians)
          rotationTolerance 3.14 # Allows grabbing from any rotation around axis
        }
      ]
    }
     
      # TODO: add TouchSensors here
      Group {
        children IS children
      }
    ]

    # Bespoke Collision (Hardcoded for Fencing)
    boundingObject Group {
      children [
        Pose { # Handle
        translation 0 -0.25 0.06
        rotation 1 0 0 1.5708
        children [
          Cylinder {
            height 0.12
            radius 0.015
          }
        ]
      }
      Pose { # Guard
        translation -1.10112e-13 -0.14 0.06
        rotation 0.9999999999944944 2.3464099999870814e-06 -2.3464099999870814e-06 1.5708
        children [
          Cylinder {
            height 0.01
            radius 0.075
          }
        ]
      }
        Pose { # Blade
          translation 3.9109e-05 0.21 0.06
          rotation -1 0 0 1.5708
          children [
            Capsule {
              height 0.67
              radius 0.04
              subdivision 16
            }
          ]
        }
      ]
    }

    # Average mass of a fencing foil
    physics Physics {
      density IS density
      mass IS mass
    }
  }
}